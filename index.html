<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>üéÅ RANDOM BOX SLOTBANGJAGO üéÅ</title>
  <script src="https://cdn.jsdelivr.net/npm/tsparticles@2/tsparticles.bundle.min.js"></script>
  <style>
    body {
      background: linear-gradient(to right, #1A0000, #800000, #1A0000);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: white;
      text-align: center;
      padding: 20px;
      min-height: 100vh;
      margin: 0;
      overflow-x: hidden;
    }
    .judul-keren {
      font-size: 48px;
      font-weight: 900;
      text-shadow: 2px 2px 0 #000, 4px 4px 0 #000;
      margin-top: 60px;
    }
    input, button {
      padding: 10px 15px;
      font-size: 16px;
      margin: 5px;
      border-radius: 5px;
    }
    .box-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      justify-content: center;
      margin-top: 30px;
    }
    .box {
      width: 120px;
      height: 120px;
      font-size: 70px;
      color: white;
      cursor: pointer;
      border: none;
      background: transparent;
      transition: 0.3s;
    }
    .box:hover { transform: scale(1.2); }
    .popup {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: flex-start;
      padding-top: 250px;
      z-index: 9999;
    }
    .popup-card {
      background: white;
      color: black;
      padding: 25px 30px;
      border-radius: 14px;
      font-size: 24px;
      font-weight: bold;
      text-align: center;
    }
    .klaim-button {
      display: inline-block;
      padding: 10px 20px;
      background: #ffcc00;
      color: black;
      font-weight: bold;
      text-decoration: none;
      border-radius: 8px;
      margin-top: 15px;
    }
  </style>
</head>
<body>

<h1 class="judul-keren">üéÅ RANDOM BOX PRIZE üéÅ</h1>
<div id="formPage">
  <input type="text" id="nama" placeholder="USERNAME">
  <input type="text" id="kode" placeholder="KODE TOKEN"><br>
  <button onclick="spinStart()">üîí <span id="btnText">MULAI VERIFIKASI</span></button>
  <div id="hasil"></div>
</div>

<div id="boxPage" style="display:none;">
  <div style="margin-bottom:10px;">
    <button onclick="tampilkanHistory()">üìú CEK HISTORI</button>
    <button onclick="kembali()">üîô KEMBALI</button>
  </div>
  <div id="boxArea" class="box-container"></div>
  <div id="historyBox" style="display:none;"></div>
</div>

<div id="popupHadiah" class="popup">
  <div class="popup-card" id="popupContent"></div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbx9-kv79wzrV4ZFWpODh1YXqnkpkiUt0qoNI61WbUSN-wxYFRjlEl-imsGp2v9krHhKsg/exec";
let namaUser = "", kodeToken = "", sudahSpin = false;

async function spinStart() {
  namaUser = document.getElementById("nama").value.trim();
  kodeToken = document.getElementById("kode").value.trim();
  const btnText = document.getElementById("btnText");
  const hasil = document.getElementById("hasil");
  if (!namaUser || !kodeToken) return alert("Isi nama & kode token dulu!");

  btnText.innerText = "MEMPROSES...";
  hasil.textContent = "‚è≥ Sedang verifikasi...";

  const res = await fetch(API, {
    method: "POST",
    headers: {"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},
    body: new URLSearchParams({action:"cekdanpakaitoken", nama:namaUser, kode:kodeToken})
  });
  const json = await res.json();

  if (json.status === "OK") {
    hasil.textContent = "";
    document.getElementById("formPage").style.display = "none";
    document.getElementById("boxPage").style.display = "block";
    generateBoxes();
  } else {
    hasil.textContent = "‚ùå " + (json.msg || "Kode tidak valid.");
  }
}

function generateBoxes() {
  const area = document.getElementById("boxArea");
  area.innerHTML = "";
  for (let i=0;i<9;i++) {
    const box = document.createElement("div");
    box.className = "box";
    box.innerHTML = "üéÅ";
    box.onclick = ()=>pilihBox(box);
    area.appendChild(box);
  }
}

async function pilihBox(el) {
  if (sudahSpin) return;
  sudahSpin = true;

  el.innerHTML = "‚è≥";
  const hadiah = ["Rp2.000","Rp3.000","Rp5.000","Rp10.000","Rp20.000"];
  const hasil = hadiah[Math.floor(Math.random()*hadiah.length)];

  await fetch(API, {
    method:"POST",
    headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},
    body:new URLSearchParams({action:"simpanhasil", nama:namaUser, kode:kodeToken, status:hasil})
  });

  setTimeout(()=>{
    el.style.background="gold";
    el.style.color="black";
    el.innerHTML=`üéâ<br>${hasil}`;
    tampilPopup(`Selamat ${namaUser}!<br>üéÅ Kamu menang ${hasil}`);
  },800);
}

function tampilPopup(msg){
  document.getElementById("popupContent").innerHTML = `
    ${msg}
    <br><a href="https://t.me/+MYu2cG2rBPwzNGQ9" target="_blank" class="klaim-button">KLAIM BONUS DISINI</a>
  `;
  document.getElementById("popupHadiah").style.display = "flex";
  document.getElementById("popupHadiah").onclick = ()=>document.getElementById("popupHadiah").style.display="none";
}

async function tampilkanHistory(){
  const historyBox = document.getElementById("historyBox");
  historyBox.innerHTML = "‚è≥ Mengambil data...";
  historyBox.style.display = "block";

  const res = await fetch(`${API}?action=ambilHistoriGabungan&nama=${encodeURIComponent(namaUser)}`);
  const data = await res.json();

  if (!data.member?.length && !data.fake?.length) {
    historyBox.innerHTML = "‚ö†Ô∏è Belum ada histori.";
    return;
  }

  let html = "<h3>üéâ Riwayat Pemenang üéâ</h3><ul style='text-align:left'>";
  data.member.forEach(r=>{ html += `<li>üèÜ ${r.nama} - ${r.status}</li>`; });
  data.fake.forEach(t=>{ html += `<li>${t}</li>`; });
  html += "</ul>";
  historyBox.innerHTML = html;
}

function kembali(){
  document.getElementById("formPage").style.display="block";
  document.getElementById("boxPage").style.display="none";
  sudahSpin=false;
}
</script>
</body>
</html>
